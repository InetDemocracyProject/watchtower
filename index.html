
<!doctype html>
<html>
<head>
  <title>India's Cyber Watchtower</title>
  <script   src="https://code.jquery.com/jquery-2.2.2.min.js"   integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="   crossorigin="anonymous"></script>
  <script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,700,900' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
  <script type="text/javascript" src="ext/tabletop.js"></script>
  <link href="http://visjs.org/dist/vis.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">

  <style type="text/css">
    body{
      font-family: 'Source Sans Pro', sans-serif;
      background: #ffffff; /* Old browsers */
      background: -moz-linear-gradient(top,  #ffffff 0%, #fffff2 100%); /* FF3.6-15 */
      background: -webkit-linear-gradient(top,  #ffffff 0%,#fffff2 100%); /* Chrome10-25,Safari5.1-6 */
      background: linear-gradient(to bottom,  #ffffff 0%,#fffff2 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
      filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#fffff2',GradientType=0 ); /* IE6-9 */
      margin:0;
      padding: 0;
    }
    #mynetwork {
      height: 700px;
      /*border: 1px solid lightgray;*/
    }
    h2{
      color: #305151;
    }
    h5{
      font-size: 11px;
      color: #B1B1B1;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.4px;
      margin-bottom: 0px;
      margin-top: 17px;
    }
    .navbar-mod{
      background-color: transparent;
      border: none;
      position: absolute;
    }
    .navbar-brand-mod{
      color: #305151;
      font-size: 24px;
      padding: 25px;
    }
    .panel-mod{
      -webkit-box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      border: none;
      position: absolute;
      top: 0;
      right: 0;
      width: 340px;
      border-radius: 0px;
    }
    .institutionName{
      margin-top: -21px;
      font-size: 24px;
    }
    #sidebar {
      position: absolute;
      width: 25%;
      top: 0%;
      right: 1%;
    }
    .sidebar-panel {
      height: 700px;
      overflow-y: auto;
    }
    .mod-layout{
      padding: 0;
      width: 100%;
    }
    .h6{
      font-size: 16px;
      margin: 2px 0px 0px 0px;
      padding: 0px 0px 4px 0px;
      line-height: 21px;
     }
  </style>
</head>
<body>
<nav class="navbar navbar-default navbar-mod">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand navbar-brand-mod" style='color: #305151;' href="/">India's Cyber Watchtower</a>
    </div>
  </div><!-- /.container-fluid -->
</nav>
<div id='ractive-container'></div>
<script id='watchtower-app' type='text/ractive'>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12 mod-layout">
        <div id="mynetwork"></div>
        <div id="sidebar">
          <div class="panel panel-default panel-mod">
            <div class="panel-body sidebar-body sidebar-panel panel-body-mod">
              {{#selectedInst}}
                <h2><p class='institutionName'>{{selectedInst['Name of Institution']}}</p></h2>
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Type tags'] !== 'NA'}}
                  <h5>Institution Type</h5>
                  <h6>{{selectedInst['Type tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Year Started'] !== 'NA'}}
                  <h5>Established In</h5>
                  <h6>{{selectedInst['Year Started']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Issue tags'] !== 'NA'}}
                  <h5>Issues</h5>
                  <h6>{{selectedInst['Issue tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['RTI?'] !== 'NA'}}
                  <h5>Under RTI?</h5>
                  <h6>{{selectedInst['RTI?']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Website link'] !== 'NA'}}
                  <h5>URL</h5>
                  <h6>{{selectedInst['Website link']}}</h6>
                {{/if}}
                <h5>Mandate</h5>
                <h6>{{selectedInst['Mandate']}}</h6>
              {{else}}
                <p>
                Insecure information and communication networks are a risk to individuals, to public safety, to the stability of businesses and to the security of nations. Governments assume a big role in keeping crucial and non-crucial networks secure from interference and disruptions, monitoring networks to crackdown on crimes committed on and off these networks- all under the banner of 'Cybersecurity'. However, in the Indian case, exactly what functions come within the sweep of the term 'Cybersecurity' is hard to say, in the absence of definitions.
                </p>
                <p>
                Some guidance can be found in the IT Act 2000, the National Cyber Security Policy 2013 and disparate ministerial documents. In <dataviz name>, we have tried to map the various agencies implicated in functions covering emergency incident response, indigineous capacity building through research and development and electronic communications surveillance.
                </p>
                <p>
                (There is assymetry in the level of information available in the public domain about these institutions, even where such institutions have dedicated websites. In several cases, no primary sources are available, but news reports and articles supply the data. The source of information is listed in every case.)
                </p>
              {{/}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>
<script>
  var Watchtower = {};
  Watchtower.styles = {
    institutions: {
      'Agency': '#58a3a5',
      'Department': '#add7d8',
      'Ministry': '#add7d8',
      'selected': '#f98e00'
    }
  }

  Watchtower.init = function(data, tabletop) {
    var watchtower = this;
    var initData = function(){
      watchtower.sheets = tabletop.sheets();
      var institutions = watchtower.sheets["All Institutions"].elements;
      var tags = watchtower.sheets['Tags'].elements;
      var issues = [];
      var types = [];
      tags.forEach(function(tag){
        issues.push({name: tag['Issue Tags'], selected: true});
        types.push({name: tag['Type Tags'], selected: true});
      })
      console.log(issues);
      console.log(types);
      watchtower.ractive = new Ractive({
        // The `el` option can be a node, an ID, or a CSS selector.
        el: '#ractive-container',

        // We could pass in a string, but for the sake of convenience
        // we're passing the ID of the <script> tag above.
        template: '#watchtower-app',

        // Here, we're passing in some initial data
        data: {
          institutions: institutions,
          instSelected: false,
          selectedInst: undefined,
          issues: issues,
          types: types,
          isMinistryOrDept: function(inst){
            return inst['Nature (Agency/Department/Ministry)'] === 'Ministry' || inst['Nature (Agency/Department/Ministry)'] === 'Department';
          }
        },
      });
      watchtower.map = watchtower.initMap();
      watchtower.map.on("select", function (params) {
        watchtower.ractive.set('instSelected', true);
        watchtower.ractive.set('selectedInst', watchtower.ractive.get('institutions').filter(function(inst){
          return inst['Serial'] === params.nodes[0];
        })[0]);
        // Watchtower.sidebar.toggle();
      });
      watchtower.map.on("deselectNode", function (params) {
        watchtower.ractive.set('instSelected', false);
        // Watchtower.sidebar.toggle();
      });
    }
    var tabletop = Tabletop.init({
      key: 'https://docs.google.com/spreadsheets/d/1prS4TLHjVimdW5teFYluTqBpTMGwnt12R-bt71dU5tM/pubhtml',
      callback: initData
    });
  }

  Watchtower.sidebar = {
    toggle: function(){
      $("#sidebar").animate({width:'toggle'},350);
    }
  }

  Watchtower.initMap = function(){
    var watchtower = this;
    var institutionNodes = [];
    var institutionEdges = [];
    var institutions = Watchtower.ractive.get('institutions');

    var isAgency = function(inst){
      return inst['Nature (Agency/Department/Ministry)'] === 'Agency';
    }

    var shouldShowInst = true;
    institutions.forEach(function(institution){
      var instColor = '#f2f2f2';
      if (Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']]) {
        instColor = Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']];
      }

      if (isAgency(institution)) {
        // Filters start

        var instIssues = institution['Issue tags'].split(",").map(function(issue){
          return issue.trim();
        });
        var instTypes = institution['Type tags'].split(",").map(function(instType){
          return instType.trim();
        });
        var selectedIssues = watchtower.ractive.get('issues').filter(function(issue){
          return issue.selected;
        });
        var selectedTypes = watchtower.ractive.get('types').filter(function(type){
          return type.selected;
        });
        if (selectedIssues.length && selectedTypes.length) {
          var isIssuePresent = false
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) > -1) {
              isIssuePresent = true;
            }
          });
          var isTypePresent = false
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) > -1) {
              isTypePresent = true;
            }
          });
          console.log(institution['Acronym']);
          console.log(instIssues);
          console.log(instTypes);
          console.log(isIssuePresent);
          console.log(isTypePresent);
          shouldShowInst = isIssuePresent && isTypePresent;
        } else if (selectedIssues.length) {
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) === -1) {
              shouldShowInst = false;
            }
          });
        } else if (selectedTypes.length) {
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) === -1) {
              shouldShowInst = false;
            }
          });
        }
      }

      if (institution['Nature (Agency/Department/Ministry)'] === 'Ministry') {
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: instColor,
          font: '20px arial #000 bold',
          title: institution['Name of Institution'],
          shadow: {color:'#2D5150'},
          image: 'assets/img/ministry.svg',
          shape: 'image'
        });
      } else {
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: shouldShowInst ? instColor : "#f2f2f2",
          font: '12px arial #fff bold',
          title: institution['Name of Institution'],
          shape: 'box',
          shadow:{color:'#2D5150'}
        });
      }

      if ((institution['Direct control'] === 'NA') && (institution['Partial control'] === 'NA') && (institution['Root'] !== 'NA')) {
        // Departments
        institutionEdges.push({
          from: institution['Serial'],
          to: institutions.filter(function(inst){
            return inst['Acronym'] === institution['Root']
          })[0]['Serial'],
          arrows:{to:{scaleFactor:0.25}}
        });
      } else {
        // Match agencies. Ministries will have Direct Control and Partial Control as NA
        if (institution['Direct control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Direct control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            color: Watchtower.styles.institutions['Agency']
          })
        }
        if (institution['Partial control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Partial control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            dashes: true,
            color: Watchtower.styles.institutions['Agency']
          })
        }
      }
    });

    var nodes = new vis.DataSet(institutionNodes);
    var edges = new vis.DataSet(institutionEdges);
    var container = document.getElementById('mynetwork');
    var data = {
      nodes: nodes,
      edges: edges
    };
    return new vis.Network(container, data, {});
  }

  Watchtower.init();

</script>

</body>
</html>
