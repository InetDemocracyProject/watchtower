
<!doctype html>
<html>
<head>
  <title>Watchtower: Mapping the Indian government's Cybersecurity Institutions</title>
  <script   src="https://code.jquery.com/jquery-2.2.2.min.js"   integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="   crossorigin="anonymous"></script>
  <script src='ext/ractive.js'></script>
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,700,900' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="ext/vis.js"></script>
  <script type="text/javascript" src="ext/tabletop.js"></script>
  <link href="ext/vis.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">
  <link rel="shortcut icon" href="https://internetdemocracy.in/wp-content/themes/internet-democracy/_img/favicon.ico"/>
  <script src="https://apis.google.com/js/platform.js" async defer></script>

  <style type="text/css">
    html {
      height: 100%;
    }
    body{
      font-family: 'Source Sans Pro', sans-serif;
      background: #ffffff; /* Old browsers */
      background: -moz-linear-gradient(top,  #ffffff 0%, #fffff2 100%); /* FF3.6-15 */
      background: -webkit-linear-gradient(top,  #ffffff 0%,#fffff2 100%); /* Chrome10-25,Safari5.1-6 */
      background: linear-gradient(to bottom,  #ffffff 0%,#fffff2 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
      filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#fffff2',GradientType=0 ); /* IE6-9 */
      margin:0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    #mynetwork {
      height: 100vh;
      /*border: 1px solid lightgray;*/
    }
    h2{
      color: #305151;
    }
    h5{
      font-size: 11px;
      color: #B1B1B1;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.4px;
      margin-bottom: 0px;
      margin-top: 17px;
      padding: 0px 15px;
    }
    h6{
      font-size: 16px;
      padding: 0px 15px;
      line-height: 22px;
      margin: 2px 0px 0px 0px;
      line-height: 21px;
    }
    .navbar-mod{
      background-color: transparent;
      border: none;
      position: absolute;
    }
    .navbar-brand-mod{
      color: #305151;
      font-size: 24px;
      padding: 25px;
    }
    .panel-mod{
      -webkit-box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      border: none;
      position: absolute;
      top: 0;
      right: 0;
      width: 357px;
      border-radius: 0px;
      z-index: 3;
    }
    .institutionName{
      margin-top: -21px;
      font-size: 24px;
      background-color: #F98E00;
      color: white;
      padding: 15px;
    }
    .panel-body-mod{
      padding: 0px;
    }
    .mod-layout{
      padding: 0;
      width: 100%;
    }
    #footer-buttons {
    }
    .footer-icons{
      width:30px;
      height:30px;
      margin-right: 10px;
      transition: 0.3s;
      z-index:99999;
    }
    .footer-icons:hover{
      cursor:pointer;
    }
    #left-footer{
      position: absolute;
      left: 25px;
      bottom: 10px;
      z-index: 1;
    }
    #right-footer{
      position: absolute;
      right: 10px;
      bottom: 10px;
      z-index: 1;
    }
    #zoom-buttons {
      position: absolute;
      bottom: 10px;
      left: 13px;
      width: 40px;
      padding: 5px;
      border-radius: 20px;
      background-color: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
      z-index: 9999;
    }
    .zoom-icons{
      width:30px;
      height:30px;
      z-index:10000;
    }
    .zoom-icons:hover{
      cursor:pointer;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomIn {
      background-image: url("images/zoomin.svg");
      position: absolute;
      top: 85px;
      left: 26px;
      width: 40px;
      padding: 5px;
      border-radius: 20px 20px 2px 2px;
      background-color: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
      z-index: 9999;
      background-size: 31px;
      background-position-x: 6px;
      background-position-y: 5px;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomOut {
        background-image: url("images/zoomout.svg");
        top: 123px;
        left: 26px;
        width: 40px;
        padding: 5px;
        border-radius: 2px 2px 20px 20px;
        background-color: white;
        box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
        z-index: 9999;
        background-size: 31px;
        background-position-x: 6px;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-up {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-down {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-left {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-right {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomExtends {
      display: none;
    }

    #sidebar {
      position: absolute;
      width: 25%;
      top: 0;
      right: 0;
    }
    .sidebar-panel {
      height: 100vh;
      overflow-y: auto;
    }
    .mod-layout{
      padding: 0;
      width: 100%;
    }
    .container-fluid-mod{
      margin-right:0px;
      padding-right:0px;
    }
    #bug-reporting{
      background-color:#f7f7f7;
      border-top:1px solid #e8e8e8;
      margin:15px;
      padding: 10px;
    }

    #filters {
      position: fixed;
      bottom: 50px;
      left: 20px;
      z-index: 999999;
      width: 490px;
      height: 331px;
    }

    #filters-left{
      float: left;
      margin-right: 0;
      border-right: 1px solid #E6E6E6 ;
      padding-right: 20px;
    }
    #filters-right{
      float:left;
      margin-left: 20px;
    }
    .filter-label-class{
      margin-left: 5px;
      font-weight: 400;
    }
    .filter-panel-mod{
      padding: 15px;
      height: 332px;
      margin-bottom: 0px;
    }
    .filter-label-mod{
      padding: 0px 0px 10px 0px;
      font-weight: 600;
    }
    .hr-mod{
      margin:10px 0px;
      padding:0;
    }
    .dl-mod{
      margin:0px;
    }
    .legend-panel-mod{
      position: absolute;
      z-index: 9999999;
      bottom: 25px;
      left: 150px;
      padding:15px;
    }
    .legend-icons{
      width:20px;
      height:20px;
      margin-right: 10px;
    }
    .mp-correction{
      margin: 0px 0px 10px 0px;
      padding: 0px;
      margin-right: 10px;
    }
    #legend {
      position: absolute;
      z-index: 9999999;
      bottom: 50px;
      left: 70px;
      padding: 15px;
      background-color: #fff;
      border-radius: 4px;
      margin-bottom: 0px;
    }
    .sidebar-close-position {
      position: absolute;
      z-index: 999;
      height: 30px;
      right: 368px;
      top: 10px;
    }
    #credits{
      padding-top: 1px;
      background-color: #f7f7f7;
    }
    .unselect-button-1{
      padding-top: 2px;
      position: absolute;
      top: 40px;
      left: 230px;
      width: 20px;
    }
    .unselect-button-2{
      position: absolute;
      top: 42px;
      left: 450px;
      width: 20px;
    }
    .sharing-panel-mod{
      position: absolute;
      z-index: 9999999;
      bottom: 30px;
      left: 180px;
      padding:15px 15px 10px 15px;
      width: 200px;
    }
    .social-button{
      margin-right: 15px;
      float: left;
    }
  </style>
</head>
<body>

  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div id='sharing' class="panel panel-default sharing-panel-mod">
  <h5 class='mp-correction'>SHARE THIS</h5>
  <div class="fb-share-button social-button" data-href="https://internetdemocracy.in/watchtower/" data-layout="button_count"></div>
  <a href="https://twitter.com/share" class="twitter-share-button social-button" data-text="A Map of Indian Government's Cyber Security Institutions" data-via="iNetDemocracy">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  <!-- <div class="g-plus social-button" data-action="share" data-height="24" data-href="https://internetdemocracy.in/watchtower/"></div> -->
</div>

<nav class="navbar navbar-default navbar-mod">
  <div class="container-fluid container-fluid-mod">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand navbar-brand-mod" style='color:#5E3242;position:relative;z-index:9999;' href="/">The Watchtower</a>
      <h6 style='color:#5E3242;clear:both;padding:0px 10px;z-index:9999;'>Mapping the Indian Government's Cyber Security Institutions</h6>
    </div>
  </div><!-- /.container-fluid -->
</nav>
<div id='ractive-container'></div>
  <script id='watchtower-app' type='text/ractive'>
  <div class="container-fluid">
  {{#if isLegendVisible}}
    <div id='legend' class="panel panel-default legend-panel-mod">
      <h5 class='mp-correction'>LEGEND</h5>
      <table>
      <tr>
        <td><img class='legend-icons' src='images/direct-legend.svg'/></td><td>Under direct control of</td>
      </tr>
      <tr>
        <td><img class='legend-icons' src='images/administrative-legend.svg'/></td><td>Under administrative control of</td>
      </tr>
      <tr>
        <td><img class='legend-icons' src='images/ministry-legend.svg'/></td><td>Ministry</td>
      </tr>
      </table>
    </div>
  {{/if}}
      <div id='left-footer'>
        <img class='footer-icons' src="images/filters.svg" alt="Filter the display" onmouseover="this.src='images/filters-hover.svg'" onmouseout="this.src='images/filters.svg'"  on-click="toggleFilters">
<!--         <img class='footer-icons' src="images/search.svg" alt="Search for an agency" onmouseover="this.src='images/search-hover.svg'" onmouseout="this.src='images/search.svg'">
 -->        <img class='footer-icons' src="images/legend.svg" alt="View legend" onmouseover="this.src='images/legend-hover.svg'" onmouseout="this.src='images/legend.svg'"  on-click="toggleLegend">
            <span style='padding:0px 10px;'>&bull;</span>
            <img class='footer-icons' src="images/about.svg" alt="About the visualisation" onmouseover="this.src='images/about-hover.svg'" onmouseout="this.src='images/about.svg'" on-click="toggleSidebar">
            <img class='footer-icons' src="images/share.svg" alt="Share this" onmouseover="this.src='images/share-hover.svg'" onmouseout="this.src='images/share.svg'" on-click="toggleShare">
      </div>
      <div id='right-footer'>
      </div>
    <div class="row">
      <div class="col-md-12 mod-layout">
        <div id="filters" {{#if !isFiltersVisible}}class='hidden'{{/if}}>
          <div class="panel panel-default filter-panel-mod">
            <div class="panel-body panel-body-mod">
            <h5 class='mp-correction'>FILTERS</h5>
              <div id='filters-left'>
                <div class="row">
                  <div class="col-md-7">
                    <h6 class='filter-label-mod'>Type of body</h6>
                  </div>
                    {{#if allTypesUnselected()}}
                      <a href="javascript:void(0);" on-click='unselectTypes'><img class='unselect-button-1' src='images/unselect-all.svg' onmouseover="this.src='images/unselect-all-hover.svg'" onmouseout="this.src='images/unselect-all.svg'"></a>
                    {{/if}}
                </div>
                <dl class='dl-mod'>
                  {{#types}}
                    <dt>
                      <input id='{{name}}' type="checkbox" checked='{{selected}}' on-change="handleTypesFilter">
                      <label  for='{{name}}' class='filter-label-class'>{{name}}</label>
                    </dt>
                  {{/types}}
                </dl>
                </div>
                <div id='filters-right'>
                  <div class="row">
                    <div class="col-md-12">
                      <h6 class='filter-label-mod'>Issues looked into</h6>
                    </div>
                      {{#if allIssuesUnselected()}}
                        <a href="javascript:void(0);" on-click='unselectIssues'><img class='unselect-button-2' src='images/unselect-all.svg' onmouseover="this.src='images/unselect-all-hover.svg'" onmouseout="this.src='images/unselect-all.svg'"></a>
                      {{/if}}
                  </div>
                  <dl class='dl-mod'>
                    {{#issues}}
                      <dt>
                        <input id='{{name}}' type="checkbox" checked='{{selected}}' on-change="handleIssuesFilter">
                        <label  for='{{name}}' class='filter-label-class'>{{name}}</label>
                       </dt>
                    {{/issues}}
                  </dl>
                  <hr class='hr-mod'>
                  <h6 class='filter-label-mod'>RTI?</h6>
                  <input id='institution-rti' type="checkbox" {{#if filter-by-rti}}checked{{/if}} on-change="handleRTIFilter">
                  <label  for='{{institution-rti}}' class='filter-label-class'>Bodies exempt from RTI</label>
                </div>
            </div>
          </div>
        </div>
        <div id="mynetwork"></div>

        <div id="sidebar" {{#if !isSidebarVisible}}class='hidden'{{/if}}>
          <a href="javascript:void(0);" on-click="closeSidebar">
            <img class='sidebar-close-position' src='images/close.svg' onmouseover="this.src='images/close-hover.svg'" onmouseout="this.src='images/close.svg'">
          </a>
          <div class="panel panel-default panel-mod">
            <div class="panel-body sidebar-body sidebar-panel panel-body-mod">
              {{#selectedInst}}
                <h2><p class='institutionName'>{{selectedInst['Name of Institution']}}</p></h2>
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Type tags'] !== 'NA'}}
                  <h5>Institution Type</h5>
                  <h6>{{selectedInst['Type tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Year Started'] !== 'NA'}}
                  <h5>Established In</h5>
                  <h6>{{selectedInst['Year Started']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Issue tags'] !== 'NA'}}
                  <h5>Issues</h5>
                  <h6>{{selectedInst['Issue tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['RTI?'] !== 'NA'}}
                  <h5>Exempted under RTI?</h5>
                  <h6>{{selectedInst['RTI?']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Website link'] !== 'NA'}}
                  <h5>URL</h5>
                  {{#if isURL(selectedInst['Website link'])}}
                    <h6><a href={{selectedInst['Website link']}} target="_blank">{{selectedInst['Website link']}}</a></h6>
                  {{else}}
                    <h6>{{selectedInst['Website link']}}</h6>
                  {{/if}}
                {{/if}}
                <h5>Mandate</h5>
                <h6>{{selectedInst['Mandate']}}</h6>
                <div id='bug-reporting'>
                  <img style='width:20px; height:20px;' src='images/bug.svg'/>&nbsp;<span style='color:#a8a8a8;'>Found incorrect information?</span>&nbsp;<a target='_blank' href='https://docs.google.com/forms/d/1XsPACAHckWwQqUd0M0I4Ld3X7Ssvor8PQABfcyxWWPI/viewform'>Let us know</a>
                </div>
              {{else}}
                <img src='images/wtlogo.png' style='width:340px;'/>
                <h6 style='color:#5E3242;padding-top:15px'>
                <p>
                How technologies are perceived and to what ends they are used, at a government-level, is important in shaping its uptake and building trust and confidence for its use. Across the world, governments are getting their feet wet in evolving an understanding of something called &lsquo;cybersecurity&rsquo;. Successive Indian governments have set up institutional mechanisms for this, with guidance from the National Cyber Security Policy of 2013, section 2 (1) (nb) of the Information Technology Amendment Act 2008, among others.
                </p>
                <p>
                With this tool, we try to give an overview of the various institutions in the central government of India which are involved in functions of cybersecurity. (The bodies shown are not of similar importance or even effectiveness. However, they all play a part in understanding how the government treats digital technologies at a time when uptake of information technology is seen as crucial for developmental goals, security threats are complex and granular data on citizens is possible for States to acquire.
                </p>
                <br/>
                A little more information about the bodies:
<ul style='padding-left: 16px;'>
<br/><li>dedicated centers are set up for keeping critical networks like power grids secure from interference</li>
<br/><li>special bodies are delegated for the maintenance of the government&lsquo;s digital resources and offerings like official websites and e-governance services</li>
<br/><li>both civilian and military intelligence agencies seek to manage security risks by monitoring information and communication networks, and expect to be prepared to prevent threats to national security. For traditional intelligence agencies looking to upgrade their ways, &lsquo;cyber&rsquo; is the prefix of choice. Some specialised agencies seek to comb social media networks to gain intelligence insights. While some of these bodies have been set up through Acts of legislature, others have been set up only through executive orders
some mechanisms are set up to create and maintain databases about citizens that help in surveillance, to be shared with other government bodies</li>
<br/><li>efforts to enhance indigenous resource capacity- human and otherwise, are made by setting up research and development bodies. These efforts seek to make the country self sufficient in its security needs by developing hardware, software and protocol standards. Some of these bodies are set up to be autonomous societies, and some of them are set up as Section 25 companies under the Companies Act.</li>
<br/><li>on the global front, governments have to represent national interests in negotiations about development of internet-related policies and ownership of critical internet resources. They also seek out cooperation with other countries on law enforcement for trans-national crimes and exchange notes on best practices.</li>
</ul>
The lack of uniformity in the level of detail about each body is partly because primary source information about many of these bodies are not available, and several of them are exempt from disclosing information about themselves under the Right to Information Act.
<br/><br/>The dataset is available at <b><a target='_blank' style='cursor:pointer;' href='https://docs.google.com/spreadsheets/d/1t_7K7Asg92NXmt9EDxvrQFYdy1w7XWMsft2xJTRTo8M/edit?usp=sharing'>here</a></b>. It is licensed under Creative Commons BY 3.0.
                </h6>
                <hr style='margin-bottom: 0;'/>
                <div id='credits'>
                  <h5>Credits</h5>
                  <a href='http://www.internetdemocracy.in/'><img src='images/idp-logo.png' style='height: 100px;width: 100px;padding: 13px;float: left;'/></a> <h6 style='color:#888;margin-top: 11px;margin-bottom:17px;'>An initiative by <br/>Internet Democracy Project<br/> <hr style='margin: 7px 0px 4px 0px;'/><span style='font-size:13px'>Research by Nayantara Ranganathan</span></h6>
                  <h6 style='float:left;clear:both;color:#888;font-size:13px;'>Design by&nbsp;&nbsp;<a target='_blank' href='http://www.folo.co.in'><img src='images/fologo.png' style='width:24px;clear:both;opacity:0.6;'/></a></h6>
                  <h6 style='font-size:13px;color:#888;margin-top: 16px;'>Developed by&nbsp;<a style='color:#888;text-decoration:underline;' href='http://www.shreyas.io'>Shreyas Satish</a></h6>
                  <hr style='margin-bottom: 0;'/>
                </div>
               {{/}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>
<script>
  var Watchtower = {};
  Watchtower.styles = {
    institutions: {
      'Agency': '#1c8481',
      'Department': '#1c8481',
      'Ministry': '#add7d8',
      'selected': '#f98e00',
      'dimmed': '#c6c6c6'
    }
  }

  Watchtower.init = function(data, tabletop) {
    var watchtower = this;
    $('#sharing').hide();
    var initData = function(){
      watchtower.sheets = tabletop.sheets();
      var institutions = watchtower.sheets["All Institutions"].elements;
      var tags = watchtower.sheets['Tags'].elements;
      var issues = [];
      var types = [];
      tags.forEach(function(tag){
        if (tag['Issue Tags'] !== '') {
          issues.push({name: tag['Issue Tags'], selected: true});
        }
        if (tag['Type Tags'] !== '') {
          types.push({name: tag['Type Tags'], selected: true});
        }
      })
      watchtower.ractive = new Ractive({
        // The `el` option can be a node, an ID, or a CSS selector.
        el: '#ractive-container',

        // We could pass in a string, but for the sake of convenience
        // we're passing the ID of the <script> tag above.
        template: '#watchtower-app',

        // Here, we're passing in some initial data
        data: {
          institutions: institutions,
          instSelected: false,
          selectedInst: undefined,
          issues: issues,
          types: types,
          exemptFromRTI: false,
          isSidebarVisible: true,
          isFiltersVisible: false,
          isLegendVisible: false,
          isMinistryOrDept: function(inst){
            return inst['Nature (Agency/Department/Ministry)'] === 'Ministry' || inst['Nature (Agency/Department/Ministry)'] === 'Department';
          },
          isURL: function(text){
            return text.trim().indexOf("http") > -1;
          },
          allTypesUnselected(){
            return this.get('types').filter(function(type){
              return type.selected;
            }).length;
          },
          allIssuesUnselected(){
            return this.get('issues').filter(function(issue){
              return issue.selected;
            }).length;
          }
        },
      });
      watchtower.initMap();

      watchtower.ractive.on('handleIssuesFilter', function(e){
        watchtower.initMap();
      });

      watchtower.ractive.on('handleTypesFilter', function(e){
        watchtower.initMap();
      });

      watchtower.ractive.on('handleRTIFilter', function(e){
        watchtower.ractive.set('exemptFromRTI', !e.context.exemptFromRTI);
        watchtower.initMap();
      });

      watchtower.ractive.on('unselectTypes', function(e){
        var types = watchtower.ractive.get('types');
        types.forEach(function(type){
          type.selected = false;
        });
        watchtower.ractive.set('types', types);
        watchtower.initMap();
      });

      watchtower.ractive.on('unselectIssues', function(e){
        var issues = watchtower.ractive.get('issues');
        issues.forEach(function(type){
          type.selected = false;
        });
        watchtower.ractive.set('issues', issues);
        watchtower.initMap();
      });

      watchtower.ractive.on('closeSidebar', function(e){
        watchtower.ractive.set('isSidebarVisible', false);
      });

      watchtower.ractive.on('toggleSidebar', function(e){
        watchtower.ractive.set('isSidebarVisible', !watchtower.ractive.get('isSidebarVisible'));
      });

      watchtower.ractive.on('toggleShare', function(e){
        watchtower.ractive.set('isLegendVisible', false);
        watchtower.ractive.set('isFiltersVisible', false);
        $('#sharing').toggle();
      });

      watchtower.ractive.on('toggleFilters', function(e){
        watchtower.ractive.set('isLegendVisible', false);
        $('#sharing').hide();
        watchtower.ractive.set('isFiltersVisible', !watchtower.ractive.get('isFiltersVisible'));
      });

      watchtower.ractive.on('toggleLegend', function(e){
        watchtower.ractive.set('isFiltersVisible', false);
        $('#sharing').hide();
        watchtower.ractive.set('isLegendVisible', !watchtower.ractive.get('isLegendVisible'));
      });

    }

    var tabletop = Tabletop.init({
      key: 'https://docs.google.com/spreadsheets/d/1prS4TLHjVimdW5teFYluTqBpTMGwnt12R-bt71dU5tM/pubhtml',
      callback: initData
    });
  }

  Watchtower.sidebar = {
    toggle: function(){
      $("#sidebar").animate({width:'toggle'},350);
    }
  }

  Watchtower.initMap = function(){
    var watchtower = this;
    var institutionNodes = [];
    var institutionEdges = [];
    var institutions = Watchtower.ractive.get('institutions');

    var isAgency = function(inst){
      return inst['Nature (Agency/Department/Ministry)'] === 'Agency';
    }

    var isMinistry = function(inst){
      return inst['Nature (Agency/Department/Ministry)'] === 'Ministry';
    }

    // empty GoI node to get the ministries into a huddle
    institutionNodes.push({
      id: "0",
      label: "GOI",
      color: '#fff',
      font: '2px arial #fff bold',
      // title: "GOI",
      // shadow: {color:'#2D5150'},
      shape: 'text'
    });


    institutions.forEach(function(institution){
      var instColor = Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']];
      if (Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']]) {
        instColor = Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']];
      }

      if (isMinistry(institution)) {
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: instColor,
          font: '30px arial #000 bold',
          title: institution['Name of Institution'],
          shadow: {color:'#c6ba99'},
          image: 'images/ministry2.png',
          shape: 'image'
        });
        // dummy edges to get the ministries to huddle
        institutionEdges.push({
          from: institution['Serial'],
          to: "0",
          arrows:{to:{scaleFactor:0.25}},
          color: '#fff'
        })

      } else if (isAgency(institution)) {
        // Filters start

        var shouldShowInst = true;
        var instIssues = institution['Issue tags'].split(",").map(function(issue){
          return issue.trim();
        });
        var instTypes = institution['Type tags'].split(",").map(function(instType){
          return instType.trim();
        });
        var selectedIssues = watchtower.ractive.get('issues').filter(function(issue){
          return issue.selected;
        });
        var selectedTypes = watchtower.ractive.get('types').filter(function(type){
          return type.selected;
        });
        if (selectedIssues.length && selectedTypes.length) {
          var isIssuePresent = false
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) > -1) {
              isIssuePresent = true;
            }
          });
          var isTypePresent = false
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) > -1) {
              isTypePresent = true;
            }
          });
          shouldShowInst = isIssuePresent && isTypePresent;
        } else if (selectedIssues.length) {
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) === -1) {
              shouldShowInst = false;
            }
          });
        } else if (selectedTypes.length) {
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) === -1) {
              shouldShowInst = false;
            }
          });
        }

        if (watchtower.ractive.get('exemptFromRTI')){
          shouldShowInst = shouldShowInst && institution['RTI?'] === 'Yes';
        }

        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: shouldShowInst ? instColor : Watchtower.styles.institutions.dimmed,
          font: '22px arial #fff bold',
          title: institution['Name of Institution'],
          shape: 'box',
          shadow:{color:'#c6ba99'}
        });

        // Ministries will have Direct Control and Partial Control as NA
        if (institution['Direct control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Direct control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            color: Watchtower.styles.institutions['Agency']
          })
        }
        if (institution['Partial control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Partial control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            dashes: true,
            color: Watchtower.styles.institutions['Agency']
          })
        }
      } else {
        // Departments
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: instColor,
          font: '24px arial #fff bold',
          title: institution['Name of Institution'],
          shape: 'box',
          shadow:{color:'#c6ba99'}
        });
        if (institution['Root'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Root']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}}
          });
        }
      }
    });

    var nodes = new vis.DataSet(institutionNodes);
    var edges = new vis.DataSet(institutionEdges);
    var container = document.getElementById('mynetwork');
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {
      layout:{
        randomSeed:5
      },
      interaction: {
        navigationButtons: true
      }
    };
    watchtower.map = new vis.Network(container, data, options);
    watchtower.map.on("select", function (params) {
      watchtower.ractive.set('instSelected', true);
      watchtower.ractive.set('selectedInst', watchtower.ractive.get('institutions').filter(function(inst){
        return inst['Serial'] === params.nodes[0];
      })[0]);
      watchtower.ractive.set('isSidebarVisible', true);
      // Watchtower.sidebar.toggle();
    });
    watchtower.map.on("deselectNode", function (params) {
      watchtower.ractive.set('isSidebarVisible', false);
      // Watchtower.sidebar.toggle();
    });
  }

  Watchtower.init();

</script>

</body>
</html>
