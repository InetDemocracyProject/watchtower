
<!doctype html>
<html>
<head>
  <title>The Watchtower: Mapping the Indian government's Cybersecurity Institutions</title>
  <script   src="https://code.jquery.com/jquery-2.2.2.min.js"   integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="   crossorigin="anonymous"></script>
  <script src='ext/ractive.js'></script>
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,600,700,900' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="ext/vis.js"></script>
  <script type="text/javascript" src="ext/tabletop.js"></script>
  <link href="ext/vis.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">
  <link rel="shortcut icon" href="https://internetdemocracy.in/wp-content/themes/internet-democracy/_img/favicon.ico"/>

  <style type="text/css">
    html {
      height: 100%;
    }
    body{
      font-family: 'Source Sans Pro', sans-serif;
      background: #ffffff; /* Old browsers */
      background: -moz-linear-gradient(top,  #ffffff 0%, #fffff2 100%); /* FF3.6-15 */
      background: -webkit-linear-gradient(top,  #ffffff 0%,#fffff2 100%); /* Chrome10-25,Safari5.1-6 */
      background: linear-gradient(to bottom,  #ffffff 0%,#fffff2 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
      filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#fffff2',GradientType=0 ); /* IE6-9 */
      margin:0;
      padding: 0;
      height: 100%;
    }
    #mynetwork {
      height: 100vh;
      /*border: 1px solid lightgray;*/
    }
    h2{
      color: #305151;
    }
    h5{
      font-size: 11px;
      color: #B1B1B1;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.4px;
      margin-bottom: 0px;
      margin-top: 17px;
      padding: 0px 15px;
    }
    h6{
      font-size: 16px;
      padding: 0px 15px;
      line-height: 22px;
      margin: 2px 0px 0px 0px;
      line-height: 21px;
    }
    .navbar-mod{
      background-color: transparent;
      border: none;
      position: absolute;
    }
    .navbar-brand-mod{
      color: #305151;
      font-size: 24px;
      padding: 25px;
    }
    .panel-mod{
      -webkit-box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      box-shadow: -2px 0px 2px rgba(45,75,76,0.2);
      border: none;
      position: absolute;
      top: 0;
      right: 0;
      width: 340px;
      border-radius: 0px;
    }
    .institutionName{
      margin-top: -21px;
      font-size: 24px;
      background-color: #F98E00;
      color: white;
      padding: 15px;
    }
    .panel-body-mod{
      padding: 0px;
    }
    .mod-layout{
      padding: 0;
      width: 100%;
    }
    #footer-buttons {
    }
    .footer-icons{
      width:30px;
      height:30px;
      margin-right: 10px;
      transition: 0.3s;
      z-index:99999;
    }
    .footer-icons:hover{
      cursor:pointer;
    }
    #left-footer{
      position: absolute;
      left: 70px;
      bottom: 10px;
      z-index: 1;
    }
    #right-footer{
      position: absolute;
      right: 10px;
      bottom: 10px;
      z-index: 1;
    }
    #zoom-buttons {
      position: absolute;
      bottom: 10px;
      left: 13px;
      width: 40px;
      padding: 5px;
      border-radius: 20px;
      background-color: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
      z-index: 9999;
    }
    .zoom-icons{
      width:30px;
      height:30px;
      z-index:10000;
    }
    .zoom-icons:hover{
      cursor:pointer;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomIn {
      background-image: url("images/zoomin.svg");
/*      bottom: 10px;
      right: 15px;
*/      position: absolute;
      bottom: 45px;
      left: 13px;
      width: 40px;
      padding: 5px;
      border-radius: 20px;
      background-color: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
      z-index: 9999;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomOut {
      background-image: url("images/zoomout.svg");
      bottom: 8px;
      left: 13px;
      width: 40px;
      padding: 5px;
      border-radius: 20px;
      background-color: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,0.3);
      z-index: 9999;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-up {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-down {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-left {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-right {
      display: none;
    }

    div.vis-network div.vis-navigation div.vis-button.vis-zoomExtends {
      display: none; 
    }

    #sidebar {
      position: absolute;
      width: 25%;
      top: 0%;
      right: 1%;
    }
    .sidebar-panel {
      height: 610px;
      overflow-y: auto;
    }
    .mod-layout{
      padding: 0;
      width: 100%;
    }
    .container-fluid-mod{
      margin-right:0px;
      padding-right:0px;
    }
    #bug-reporting{
      background-color:#f7f7f7;
      border-top:1px solid #e8e8e8;
      margin:15px;
      padding: 10px;
    }

/*    #filters {
      position: fixed;
      bottom: 45px;
      left: 65px;
      z-index: 999999;
    }
*/
    #filters {
      position: fixed;
      top: 11%;
      left: 5%;
      z-index: 999999;
    }
    .filter-label-class{
      margin-left: 5px;
      font-weight: 400;
    }
    .filter-panel-mod{
      padding:15px;
      height:610px;
      margin-bottom: 0px;
    }
    .filter-label-mod{
      padding: 0px 0px 10px 0px;
      font-weight: 600;
    }
    .hr-mod{
      margin:10px 0px;
      padding:0;
    }
    .dl-mod{
      margin:0px;
    }
    .legend-panel-mod{
      position: absolute;
      z-index: 9999999;
      bottom: 25px;
      left: 150px;
      padding:15px;
    }
    .legend-icons{
      width:20px;
      height:20px;
    }
    .mp-correction{
      margin: 0px 0px 10px 0px;
      padding: 0px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-default navbar-mod">
  <div class="container-fluid container-fluid-mod">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand navbar-brand-mod" style='color:#5E3242;position:relative;z-index:9999;' href="/">The Watchtower</a>
      <h6 style='color:#5E3242;clear:both;padding:0px 10px;z-index:9999;'>Mapping the Indian Government's Cyber Security Institutions</h6>
    </div>
  </div><!-- /.container-fluid -->
</nav>
<div id='ractive-container'></div>
  <script id='watchtower-app' type='text/ractive'>
  <div class="container-fluid">
  <div id='legend' {{#if isLegendVisible}}class="panel panel-default legend-panel-mod"}}{{else}}class='panel panel-default legend-panel-mod hidden'{{/if}}>
    <h5 class='mp-correction'>LEGEND</h5>
    <table>
    <tr>
      <td><img class='legend-icons' src='images/direct-legend.svg'/></td><td>Under direct control of</td>
    </tr>
    <tr>
      <td><img class='legend-icons' src='images/administrative-legend.svg'/></td><td>Under administrative control of</td>
    </tr>
    <tr>
      <td><img class='legend-icons' src='images/ministry-legend.svg'/></td><td>Ministry</td>
    </tr>
    </table>
  </div>
      <div id='left-footer'>
        <img class='footer-icons' src="images/filters.svg" alt="Filter the display" onmouseover="this.src='images/filters-hover.svg'" onmouseout="this.src='images/filters.svg'"  on-click="toggleFilters">
        <img class='footer-icons' src="images/search.svg" alt="Search for an agency" onmouseover="this.src='images/search-hover.svg'" onmouseout="this.src='images/search.svg'">
        <img class='footer-icons' src="images/legend.svg" alt="View legend" onmouseover="this.src='images/legend-hover.svg'" onmouseout="this.src='images/legend.svg'"  on-click="toggleLegend">
      </div>
      <div id='right-footer'>
        <img class='footer-icons' src="images/about.svg" alt="About the visualisation" onmouseover="this.src='images/about-hover.svg'" onmouseout="this.src='images/about.svg'" on-click="toggleSidebar">
        <img class='footer-icons' src="images/share.svg" alt="Share this" onmouseover="this.src='images/share-hover.svg'" onmouseout="this.src='images/share.svg'">
      </div>
    <div class="row">
      <div class="col-md-12 mod-layout">
        <div id="filters" {{#if !isFiltersVisible}}class='hidden'{{/if}}>
          <div class="panel panel-default filter-panel-mod">
            <div class="panel-body sidebar-body sidebar-panel panel-body-mod">
            <h5 class='mp-correction'>FILTERS</h5>
              <h6 class='filter-label-mod'>Issues looked into</h6>
              <dl class='dl-mod'>
                {{#issues}}
                  <dt>
                    <input id='{{name}}' type="checkbox" {{#if selected}}checked{{/if}} on-change="handleIssuesFilter">
                    <label  for='{{name}}' class='filter-label-class'>{{name}}</label>
                  </dt>
                {{/issues}}
              </dl>
              <hr class='hr-mod'>
              <h6 class='filter-label-mod'>Type of body</h6>
              <dl>
              {{#types}}
                <dt>
                  <input id='{{name}}' type="checkbox" {{#if selected}}checked{{/if}} on-change="handleTypesFilter">
                  <label  for='{{name}}' class='filter-label-class'>{{name}}</label>
                </dt>
              {{/types}}
              <hr class='hr-mod'>
              <h6 class='filter-label-mod'>RTI?</h6>
              <input id='institution-rti' type="checkbox" {{#if filter-by-rti}}checked{{/if}} on-change="handleRTIFilter">
              <label  for='{{institution-rti}}' class='filter-label-class'>Bodies exempt from RTI</label>
              </dl>
            </div>
          </div>
        </div>
        <div id="mynetwork"></div>

        <div id="sidebar" {{#if !isSidebarVisible}}class='hidden'{{/if}}>
          <a href="javascript:void(0);" on-click="closeSidebar">Close</a>
          <div class="panel panel-default panel-mod">
            <div class="panel-body sidebar-body sidebar-panel panel-body-mod">
              {{#selectedInst}}
                <h2><p class='institutionName'>{{selectedInst['Name of Institution']}}</p></h2>
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Type tags'] !== 'NA'}}
                  <h5>Institution Type</h5>
                  <h6>{{selectedInst['Type tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Year Started'] !== 'NA'}}
                  <h5>Established In</h5>
                  <h6>{{selectedInst['Year Started']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Issue tags'] !== 'NA'}}
                  <h5>Issues</h5>
                  <h6>{{selectedInst['Issue tags']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['RTI?'] !== 'NA'}}
                  <h5>Exempted under RTI?</h5>
                  <h6>{{selectedInst['RTI?']}}</h6>
                {{/if}}
                {{#if !isMinistryOrDept(selectedInst) || selectedInst['Website link'] !== 'NA'}}
                  <h5>URL</h5>
                  <h6>{{selectedInst['Website link']}}</h6>
                {{/if}}
                <h5>Mandate</h5>
                <h6>{{selectedInst['Mandate']}}</h6>
                <div id='bug-reporting'>
                  <img style='width:20px; height:20px;' src='images/bug.svg'/>&nbsp;<span style='color:#a8a8a8;'>Found incorrect information?</span>&nbsp;<a target='_blank' href='https://docs.google.com/forms/d/1XsPACAHckWwQqUd0M0I4Ld3X7Ssvor8PQABfcyxWWPI/viewform'>Let us know</a>
                </div>
              {{else}}
                <img src='images/head.png' style='width:340px;'/>
                <h6 style='color:#5E3242;'><br/>'Cyber-security' is a phrase that one encounters often in government-speak. But the phrase is used to describe a whole range of efforts and governance mechanisms, so it muddles more than it clarifies. This interactive visualisation maps government bodies at the central level that are engaged in functions of 'cyber-security'.
                <br/><br/>The issues that these bodies deal with have broadly been grouped into:
                <br/><br/><b>Infrastructure</b> <br/>The setting up and maintenance of 'information and communication technology' infrastructure for the government
                <br/><br/><b>Critical Information Infrastructure Protection</b> <br/>Protection of critical information infrastructure like the networks of power grids and banks
                <br/><br/><b>Global Internet Governance</b> <br/>Representing the Indian government in global internet governance processes, sharing best practices about security and enhancing cooperation with other countries for better law enforcement
                <br/><br/><b>Research &amp; Development</b> <br/>Conducting research and development to improve indigenous technologies and build capacity
                <br/><br/><b>Surveillance</b> <br/>As part of security efforts, intelligence agencies not only look out for crimes that are directly related to the interference and disruption of networks, but also criminal activity that involves communication over networks. This includes traditional intelligence agencies as well as specialised agencies dedicated to making networks legible and easy to surveil
                7 ministries with their respective departments and 55 institutions have been mapped</h6>
              {{/}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>
<script>
  var Watchtower = {};
  Watchtower.styles = {
    institutions: {
      'Agency': '#1c8481',
      'Department': '#1c8481',
      'Ministry': '#add7d8',
      'selected': '#f98e00',
      'dimmed': '#c6c6c6'
    }
  }

  Watchtower.init = function(data, tabletop) {
    var watchtower = this;
    var initData = function(){
      watchtower.sheets = tabletop.sheets();
      var institutions = watchtower.sheets["All Institutions"].elements;
      var tags = watchtower.sheets['Tags'].elements;
      var issues = [];
      var types = [];
      tags.forEach(function(tag){
        if (tag['Issue Tags'] !== '') {
          issues.push({name: tag['Issue Tags'], selected: true});
        }
        if (tag['Type Tags'] !== '') {
          types.push({name: tag['Type Tags'], selected: true});
        }
      })
      watchtower.ractive = new Ractive({
        // The `el` option can be a node, an ID, or a CSS selector.
        el: '#ractive-container',

        // We could pass in a string, but for the sake of convenience
        // we're passing the ID of the <script> tag above.
        template: '#watchtower-app',

        // Here, we're passing in some initial data
        data: {
          institutions: institutions,
          instSelected: false,
          selectedInst: undefined,
          issues: issues,
          types: types,
          exemptFromRTI: false,
          isSidebarVisible: false,
          isFiltersVisible: false,
          isLegendVisible: false,
          isMinistryOrDept: function(inst){
            return inst['Nature (Agency/Department/Ministry)'] === 'Ministry' || inst['Nature (Agency/Department/Ministry)'] === 'Department';
          }
        },
      });
      watchtower.initMap();

      watchtower.ractive.on('handleIssuesFilter', function(e){
        var issues = watchtower.ractive.get('issues');
        issues.forEach(function(issue){
          if (issue.name === e.context.name) {
            issue.selected = !e.context.selected;
          }
        });
        watchtower.ractive.set('issues', issues);
        watchtower.initMap();
        console.log("toggled");
      });

      watchtower.ractive.on('handleTypesFilter', function(e){
        var types = watchtower.ractive.get('types');
        types.forEach(function(type){
          if (type.name === e.context.name) {
            type.selected = !e.context.selected;
          }
        });
        watchtower.ractive.set('types', types);
        watchtower.initMap();
        console.log("toggled");
      });

      watchtower.ractive.on('handleRTIFilter', function(e){
        console.log(!e.context.exemptFromRTI);
        watchtower.ractive.set('exemptFromRTI', !e.context.exemptFromRTI);
        watchtower.initMap();
      });

      watchtower.ractive.on('toggleSidebar', function(e){
        watchtower.ractive.set('isSidebarVisible', !watchtower.ractive.get('isSidebarVisible'));
      });

      watchtower.ractive.on('toggleFilters', function(e){
        watchtower.ractive.set('isFiltersVisible', !watchtower.ractive.get('isFiltersVisible'));
      });

      watchtower.ractive.on('toggleLegend', function(e){
        watchtower.ractive.set('isLegendVisible', !watchtower.ractive.get('isLegendVisible'));
      });
    }
    var tabletop = Tabletop.init({
      key: 'https://docs.google.com/spreadsheets/d/1prS4TLHjVimdW5teFYluTqBpTMGwnt12R-bt71dU5tM/pubhtml',
      callback: initData
    });
  }

  Watchtower.sidebar = {
    toggle: function(){
      $("#sidebar").animate({width:'toggle'},350);
    }
  }

  Watchtower.initMap = function(){
    var watchtower = this;
    var institutionNodes = [];
    var institutionEdges = [];
    var institutions = Watchtower.ractive.get('institutions');

    var isAgency = function(inst){
      return inst['Nature (Agency/Department/Ministry)'] === 'Agency';
    }

    var isMinistry = function(inst){
      return inst['Nature (Agency/Department/Ministry)'] === 'Ministry';
    }

    // empty GoI node to get the ministries into a huddle
    institutionNodes.push({
      id: "0",
      label: "GOI",
      color: '#fff',
      font: '2px arial #fff bold',
      // title: "GOI",
      // shadow: {color:'#2D5150'},
      shape: 'text'
    });


    institutions.forEach(function(institution){
      var instColor = Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']];
      if (Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']]) {
        instColor = Watchtower.styles.institutions[institution['Nature (Agency/Department/Ministry)']];
      }

      if (isMinistry(institution)) {
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: instColor,
          font: '27px arial #000 bold',
          title: institution['Name of Institution'],
          shadow: {color:'#2D5150'},
          image: 'images/ministry.png',
          shape: 'image'
        });
        // dummy edges to get the ministries to huddle
        institutionEdges.push({
          from: institution['Serial'],
          to: "0",
          arrows:{to:{scaleFactor:0.25}},
          color: '#fff'
        })

      } else if (isAgency(institution)) {
        // Filters start

        var shouldShowInst = true;
        var instIssues = institution['Issue tags'].split(",").map(function(issue){
          return issue.trim();
        });
        var instTypes = institution['Type tags'].split(",").map(function(instType){
          return instType.trim();
        });
        var selectedIssues = watchtower.ractive.get('issues').filter(function(issue){
          return issue.selected;
        });
        var selectedTypes = watchtower.ractive.get('types').filter(function(type){
          return type.selected;
        });
        if (selectedIssues.length && selectedTypes.length) {
          var isIssuePresent = false
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) > -1) {
              isIssuePresent = true;
            }
          });
          var isTypePresent = false
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) > -1) {
              isTypePresent = true;
            }
          });
          shouldShowInst = isIssuePresent && isTypePresent;
        } else if (selectedIssues.length) {
          selectedIssues.forEach(function(selectedIssue){
            if (instIssues.indexOf(selectedIssue.name) === -1) {
              shouldShowInst = false;
            }
          });
        } else if (selectedTypes.length) {
          selectedTypes.forEach(function(selectedType){
            if (instTypes.indexOf(selectedType.name) === -1) {
              shouldShowInst = false;
            }
          });
        }

        if (watchtower.ractive.get('exemptFromRTI')){
          shouldShowInst = shouldShowInst && institution['RTI?'] === 'Yes';
        }

        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: shouldShowInst ? instColor : Watchtower.styles.institutions.dimmed,
          font: '22px arial #fff bold',
          title: institution['Name of Institution'],
          shape: 'box',
          shadow:{color:'#2D5150'}
        });

        // Ministries will have Direct Control and Partial Control as NA
        if (institution['Direct control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Direct control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            color: Watchtower.styles.institutions['Agency']
          })
        }
        if (institution['Partial control'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Partial control']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}},
            dashes: true,
            color: Watchtower.styles.institutions['Agency']
          })
        }
      } else {
        // Departments
        console.log(institution);
        institutionNodes.push({
          id: institution['Serial'],
          label: institution['Acronym'],
          color: instColor,
          font: '24px arial #fff bold',
          title: institution['Name of Institution'],
          shape: 'box',
          shadow:{color:'#2D5150'}
        });
        if (institution['Root'] !== 'NA') {
          institutionEdges.push({
            from: institution['Serial'],
            to: institutions.filter(function(inst){
              return inst['Acronym'] === institution['Root']
            })[0]['Serial'],
            arrows:{to:{scaleFactor:0.25}}
          });
        }
      }
    });

    var nodes = new vis.DataSet(institutionNodes);
    var edges = new vis.DataSet(institutionEdges);
    var container = document.getElementById('mynetwork');
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {
      layout:{
        randomSeed:1
      },
      interaction: {
        navigationButtons: true
      }
    };
    watchtower.map = new vis.Network(container, data, options);
    watchtower.map.on("select", function (params) {
      watchtower.ractive.set('instSelected', true);
      console.log(params.nodes[0]);
      watchtower.ractive.set('selectedInst', watchtower.ractive.get('institutions').filter(function(inst){
        return inst['Serial'] === params.nodes[0];
      })[0]);
      watchtower.ractive.set('isSidebarVisible', true);
      // Watchtower.sidebar.toggle();
    });
    watchtower.map.on("deselectNode", function (params) {
      watchtower.ractive.set('isSidebarVisible', false);
      // Watchtower.sidebar.toggle();
    });
  }

  Watchtower.init();

</script>

</body>
</html>
